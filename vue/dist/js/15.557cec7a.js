"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[15],{5015:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"search"},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入教材名称"},model:{value:e.textbookName,callback:function(t){e.textbookName=t},expression:"textbookName"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",plain:""},on:{click:function(t){return e.load(1)}}},[e._v("查询")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",plain:""},on:{click:e.reset}},[e._v("重置")]),"DEANSOFFICE"===e.user.roleName?t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.exportBatch}},[e._v("导出")]):e._e()],1),t("div",{staticClass:"operation"},["ADMIN"===e.user.roleName?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("新增")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{attrs:{type:"danger",plain:""},on:{click:e.delBatch}},[e._v("批量删除")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{attrs:{type:"success",plain:""},on:{click:e.eport}},[e._v("导入书单")]):e._e(),t("el-button",[t("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-text":"未审批"},on:{change:e.loadOrderStatus},model:{value:e.available,callback:function(t){e.available=t},expression:"available"}})],1),"DEANSOFFICE"===e.user.roleName?t("el-button",[t("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-text":"已通过"},on:{change:e.loadApproved},model:{value:e.approvedAvailable,callback:function(t){e.approvedAvailable=t},expression:"approvedAvailable"}})],1):e._e()],1),t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",idth:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"orderFormId",label:"序号",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"isbn",label:"ISBN号","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"textbookName",label:"教材名称","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"applicationNumber",label:"申请数量","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"departmentName",label:"使用部门",align:"center"}}),t("el-table-column",{attrs:{prop:"applicationTime",label:"申请时间",align:"center"}}),t("el-table-column",{attrs:{prop:"realName",label:"申请人",align:"center"}}),t("el-table-column",{attrs:{prop:"applicationIllustration",label:"申请说明",align:"center"}}),t("el-table-column",{attrs:{width:"180",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return["1"===a.row.applicationStatus&&"MANAGER"===e.user.roleName||"2"===a.row.applicationStatus&&"DEANSOFFICE"===e.user.roleName?t("el-button",{attrs:{type:"primary",plain:"true",size:"small"},on:{click:function(t){return e.approve(a.row)}}},[e._v("审批")]):"2"===a.row.applicationStatus&&"MANAGER"===e.user.roleName?t("span",[e._v("已审批")]):"3"===a.row.applicationStatus&&"DEANSOFFICE"===e.user.roleName?t("span",[e._v("已通过")]):"4"===a.row.applicationStatus&&"DEANSOFFICE"===e.user.roleName?t("span",[e._v("未通过")]):e._e()]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.pageNum,"page-sizes":[1,10,20],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"审批",name:"信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"orderFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.orderForm,rules:e.orderFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"审批状态",prop:"applicationStatus"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.orderForm.applicationStatus,callback:function(t){e.$set(e.orderForm,"applicationStatus",t)},expression:"orderForm.applicationStatus"}},[t("el-option",{attrs:{label:"通过",value:"3"}}),t("el-option",{attrs:{label:"不通过",value:"4"}})],1)],1),t("el-form-item",{attrs:{label:"审批回复",prop:"replyMessage"}},[t("el-input",{attrs:{type:"textarea",placeholder:"审批回复"},model:{value:e.orderForm.replyMessage,callback:function(t){e.$set(e.orderForm,"replyMessage",t)},expression:"orderForm.replyMessage"}})],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px","margin-left":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveOrderForm}},[e._v("保 存")])],1)],1)],1)],1)])},l=[],o={name:"Application",data(){return{available:!1,approvedAvailable:!1,fromVisible:!1,tableData:[],pageNum:1,pageSize:10,departmentId:0,total:0,orderForm:{},orderFormRules:[{applicationStatus:[{required:!0,message:"请选择",trigger:"blur"}]}],user:JSON.parse(localStorage.getItem("xm-user")||"{}"),orderFormDate:[],orderFormIds:[],orderFormSelected:[]}},created(){this.load(1),this.loadOrderForm()},methods:{loadOrderForm(){this.$request.get("/orderForm/selectAll").then((e=>{"200"===e.code?this.orderFormDate=e.data:this.$message.error(e,msg)}))},load(e){e&&(this.pageNum=e),this.$request.get("/orderForm/selectPage",{params:{pageNum:this.pageNum,pageSize:this.pageSize,textbookName:this.textbookName,departmentId:this.user.departmentId,applicationStatus:this.applicationStatus,cancelStatus:"1"}}).then((e=>{this.tableData=e.data?.list,"MANAGER"===this.user.roleName?this.tableData=this.tableData.map((e=>("1"!==e.applicationStatus&&(e.applicationStatus="2"),e))):this.tableData=this.tableData.filter((e=>"2"===e.applicationStatus||"3"===e.applicationStatus||"4"===e.applicationStatus)),this.total=e.data?.total}))},approve(e){this.orderForm=JSON.parse(JSON.stringify(e)),this.orderForm.applicationStatus=null,this.orderForm.replyMessage=null,this.fromVisible=!0},saveOrderForm(){this.$request.post("/orderForm/approveOrder",this.orderForm,{params:{roleId:this.user.roleId}}).then((e=>{"200"===e.code?(this.$message.success("操作成功"),this.orderForm={},this.fromVisible=!1,this.load(1)):this.$message.error(e.msg)}))},loadOrderStatus(){!0===this.available?(3===this.user.roleId?this.applicationStatus="1":4===this.user.roleId&&(this.applicationStatus="2"),this.load(1)):(this.applicationStatus=null,this.load(1))},loadApproved(){!0===this.approvedAvailable?(this.applicationStatus="3",this.load(1)):(this.applicationStatus=null,this.load(1))},exportBatch(){if(!this.orderFormIds.length)return void this.$message.warning("请选择数据");for(let t=0;t<this.orderFormSelected.length;t++)if("4"===this.orderFormSelected[t].applicationStatus||"2"===this.orderFormSelected[t].applicationStatus)return void this.$message.warning("存在未通过的申请");let e=this.orderFormIds.join(",");window.open(this.$baseUrl+"/orderForm/exportBatch?token="+this.user.token+"&orderFormIdList="+e)},handleSelectionChange(e){this.orderFormIds=e.map((e=>e.orderFormId)),this.orderFormSelected=e.map((e=>e))},reset(){this.textbookName=null,this.load(1)},handleCurrentChange(e){this.load(e)},handleBookCoverSuccess(e,t,a){this.form.bookCover=e.data}}},i=o,s=a(3736),n=(0,s.Z)(i,r,l,!1,null,"a41f14a6",null),p=n.exports}}]);
//# sourceMappingURL=15.557cec7a.js.map