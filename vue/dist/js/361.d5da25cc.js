"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[361],{4361:function(e,t,r){r.r(t),r.d(t,{default:function(){return d}});var o=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"search"},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入教材名称"},model:{value:e.queryCondition.textbookName,callback:function(t){e.$set(e.queryCondition,"textbookName",t)},expression:"queryCondition.textbookName"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",plain:""},on:{click:function(t){return e.load(1)}}},[e._v("查询")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",plain:""},on:{click:e.reset}},[e._v("重置")])],1),t("div",{staticClass:"operation"},["ADMIN"===e.user.roleName?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",plain:""},on:{click:e.handleAdd}},[e._v("新增")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{attrs:{type:"danger",plain:""},on:{click:e.delBatch}},[e._v("批量删除")]):e._e(),t("el-upload",{staticStyle:{display:"inline-block","margin-left":"10px"},attrs:{headers:{token:e.user.token},action:e.$baseUrl+"/textbook/importTextbook","show-file-list":!1,"on-success":e.handleImport}},["ADMIN"===e.user.roleName?t("el-button",{attrs:{type:"success",plain:""}},[e._v("导入书单")]):e._e()],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini"}},[t("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-text":"可征订"},on:{change:e.loadOrderStatus},model:{value:e.available,callback:function(t){e.available=t},expression:"available"}})],1)],1),t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",idth:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"textbookId",label:"序号",align:"center",sortable:""}}),t("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[r.row.bookCover?t("el-image",{staticStyle:{width:"30px",height:"40px","border-radius":"0"},attrs:{src:r.row.bookCover,"preview-src-list":[r.row.bookCover]}}):e._e()],1)]}}])}),t("el-table-column",{attrs:{prop:"isbn",label:"ISBN号","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"textbookName",label:"教材名称","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"categoryName",label:"教材分类","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"press",label:"出版社",align:"center"}}),t("el-table-column",{attrs:{prop:"author",label:"作者",align:"center"}}),t("el-table-column",{attrs:{prop:"version",label:"版本",align:"center"}}),t("el-table-column",{attrs:{prop:"orderStatus",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:r}){return["1"===r.orderStatus?t("span",[e._v("可征订")]):(r.orderStatus,t("span",[e._v("不可用")]))]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return["ADMIN"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("编辑")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"danger",size:"mini"},on:{click:function(t){return e.del(r.row.textbookId)}}},[e._v("删除")]):e._e(),"TEACHER"===e.user.roleName||"MANAGER"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"success",size:"mini"},on:{click:function(t){return e.order(r.row)}}},[e._v("征订")]):e._e()]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.pageNum,"page-sizes":[1,10,20],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1),t("el-dialog",{attrs:{title:"",name:"信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"封面"}},[t("div",[t("el-upload",{attrs:{"list-type":"picture-card",action:e.$baseUrl+"/files/upload","show-file-list":!1,"on-success":e.handleBookCoverSuccess}},[e.form.bookCover?t("img",{staticClass:"avatar",staticStyle:{width:"148px",height:"148px"},attrs:{src:e.form.bookCover}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)]),t("el-form-item",{attrs:{label:"书名",prop:"textbookName"}},[t("el-input",{attrs:{placeholder:"书名"},model:{value:e.form.textbookName,callback:function(t){e.$set(e.form,"textbookName",t)},expression:"form.textbookName"}})],1),t("el-form-item",{attrs:{label:"ISBN",prop:"isbn"}},[t("el-input",{attrs:{placeholder:"ISBN"},model:{value:e.form.isbn,callback:function(t){e.$set(e.form,"isbn",t)},expression:"form.isbn"}})],1),t("el-form-item",{attrs:{label:"类别",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择种类"},model:{value:e.form.categoryId,callback:function(t){e.$set(e.form,"categoryId",t)},expression:"form.categoryId"}},e._l(e.categoryData,(function(e){return t("el-option",{key:e.categoryName,attrs:{label:e.categoryName,value:e.categoryId}})})),1)],1),t("el-form-item",{attrs:{label:"出版社",prop:"press"}},[t("el-input",{attrs:{placeholder:"出版社"},model:{value:e.form.press,callback:function(t){e.$set(e.form,"press",t)},expression:"form.press"}})],1),t("el-form-item",{attrs:{label:"作者",prop:"author"}},[t("el-input",{attrs:{placeholder:"作者"},model:{value:e.form.author,callback:function(t){e.$set(e.form,"author",t)},expression:"form.author"}})],1),t("el-form-item",{attrs:{label:"版本",prop:"version"}},[t("el-input",{attrs:{placeholder:"版本"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),t("el-form-item",{attrs:{label:"征订",prop:"orderStatus"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.orderStatus,callback:function(t){e.$set(e.form,"orderStatus",t)},expression:"form.orderStatus"}},[t("el-option",{attrs:{label:"可征订",value:"1"}}),t("el-option",{attrs:{label:"不可用",value:"0"}})],1)],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保 存")])],1)],1)],1),t("el-dialog",{attrs:{title:"征订单",name:"征订",visible:e.orderVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.orderVisible=t}}},[t("el-form",{ref:"orderFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.orderForm,rules:e.orderRules,"label-width":"100px"}},[t("el-image",{staticStyle:{"margin-left":"100px","margin-bottom":"20px",width:"100px",height:"100px"},attrs:{src:e.orderForm.bookCover,"preview-src-list":""}}),t("el-form-item",{attrs:{label:"书名",prop:"textbookName"}},[t("el-input",{attrs:{readonly:"",placeholder:"书名"},model:{value:e.orderForm.textbookName,callback:function(t){e.$set(e.orderForm,"textbookName",t)},expression:"orderForm.textbookName"}})],1),t("el-form-item",{attrs:{label:"ISBN",prop:"isbn"}},[t("el-input",{attrs:{readonly:"",placeholder:"ISBN"},model:{value:e.orderForm.isbn,callback:function(t){e.$set(e.orderForm,"isbn",t)},expression:"orderForm.isbn"}})],1),t("el-form-item",{attrs:{label:"申请数量",prop:"applicationNumber"}},[t("el-input",{attrs:{placeholder:"申请数量"},model:{value:e.orderForm.applicationNumber,callback:function(t){e.$set(e.orderForm,"applicationNumber",t)},expression:"orderForm.applicationNumber"}})],1),t("el-form-item",{attrs:{label:"使用系别",prop:"departmentId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"使用系别"},model:{value:e.orderForm.departmentId,callback:function(t){e.$set(e.orderForm,"departmentId",t)},expression:"orderForm.departmentId"}},e._l(e.departmentData,(function(e){return t("el-option",{key:e.departmentId,attrs:{label:e.departmentName,value:e.departmentId}})})),1)],1),t("el-form-item",{attrs:{label:"申请说明",prop:"applicationIllustration"}},[t("el-input",{attrs:{type:"textarea",row:2,placeholder:"申请说明"},model:{value:e.orderForm.applicationIllustration,callback:function(t){e.$set(e.orderForm,"applicationIllustration",t)},expression:"orderForm.applicationIllustration"}})],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveOrder}},[e._v("保 存")])],1)],1)],1)],1)},a=[],l={name:"Textbook",data(){return{available:!1,tableData:[],departmentData:[],categoryData:[],pageNum:1,pageSize:10,total:0,fromVisible:!1,orderVisible:!1,orderForm:{},form:{},rules:{isbn:[{required:!0,message:"请输入ISBN号",trigger:"blur"}],textbookName:[{required:!0,message:"请输入教材名",trigger:"blur"}],categoryId:[{required:!0,message:"请选择种类",trigger:"blur"}],press:[{required:!0,message:"请输入出版社",trigger:"blur"}],author:[{required:!0,message:"请输入作者",trigger:"blur"}],version:[{required:!0,message:"请输入版本",trigger:"blur"}],orderStatus:[{required:!0,message:"请选择状态",trigger:"blur"}]},orderRules:{applicationNumber:[{required:!0,message:"请输入数量",trigger:"blur"},{pattern:/^[1-9][0-9]*$/,message:"数量格式不对，请输入数字",trigger:"blur"}],departmentId:[{required:!0,message:"请选择系别",trigger:"blur"}]},user:JSON.parse(localStorage.getItem("xm-user")||"{}"),queryCondition:{textbookName:null,orderStatus:null},textbookData:[],textbookIds:[]}},created(){this.load(this.pageNum),this.loadTextbook(),this.selectCategory(),this.loadDepartment()},methods:{handleImport(e,t,r){"200"===e.code?(this.$message.success("导入成功"),this.load(1)):this.$message.error(e.msg)},loadTextbook(){this.$request.get("/textbook/selectAll").then((e=>{"200"===e.code?this.textbookData=e.data:this.$message.error(e.msg)}))},loadDepartment(){this.$request.get("/department/selectAll").then((e=>{"200"===e.code?this.departmentData=e.data:this.$message.error(e.msg)}))},load(e){this.$request.get("/textbook/selectPage",{params:{pageNum:e,pageSize:this.pageSize,textbookName:this.queryCondition.textbookName,orderStatus:this.queryCondition.orderStatus}}).then((e=>{this.tableData=e.data?.list,this.total=e.data?.total}))},loadOrderStatus(){!0===this.available?(this.queryCondition.orderStatus="1",this.load(1)):(this.queryCondition.orderStatus=null,this.load(1))},handleAdd(){this.form={},this.fromVisible=!0},handleEdit(e){this.form=JSON.parse(JSON.stringify(e)),this.fromVisible=!0},order(e){"1"!==e.orderStatus?this.$message.error("暂不可征订"):(this.orderForm={},this.orderVisible=!0,this.orderForm.textbookName=e.textbookName,this.orderForm.isbn=e.isbn,this.orderForm.bookCover=e.bookCover)},save(){this.$refs["formRef"].validate((e=>{e&&this.$request({url:this.form.textbookId?"/textbook/updateTextbook":"/textbook/addTextbook",method:this.form.textbookId?"PUT":"POST",data:this.form}).then((e=>{"200"===e.code?(this.$message.success("保存成功"),this.load(1),this.fromVisible=!1):this.$message.error(e.msg)}))}))},saveOrder(){this.$refs["orderFormRef"].validate((e=>{e&&this.$request.post("/orderForm/addOrderForm",this.orderForm).then((e=>{"200"===e.code?(this.$message.success("征订成功"),this.orderVisible=!1):this.$message.error(e.msg)}))}))},selectCategory(){this.$request.get("/category/selectAll").then((e=>{this.categoryData=e.data}))},del(e){this.$confirm("您确定删除吗？","确认删除",{type:"warning"}).then((t=>{this.$request.delete("/textbook/deleteById/"+e).then((e=>{"200"===e.code?(this.$message.success("删除成功"),this.load(this.pageNum)):this.$message.error(e.msg)}))})).catch((()=>{this.load(1)}))},handleSelectionChange(e){this.textbookIds=e.map((e=>e.textbookId))},delBatch(){this.textbookIds.length?this.$confirm("您确定批量删除这些数据吗？","确认删除",{type:"warning"}).then((e=>{this.$request.delete("/textbook/deleteBatch",{data:this.textbookIds}).then((e=>{"200"===e.code?(this.$message.success("删除成功"),this.load(this.pageNum)):this.$message.error(e.msg)}))})).catch((()=>{})):this.$message.warning("请选择数据")},reset(){this.queryCondition.textbookName=null,this.load(1)},handleCurrentChange(e){this.pageNum=e,this.load(this.pageNum)},handleBookCoverSuccess(e,t,r){this.form.bookCover=e.data}}},s=l,i=r(3736),n=(0,i.Z)(s,o,a,!1,null,"c56bd268",null),d=n.exports}}]);
//# sourceMappingURL=361.d5da25cc.js.map