"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[813],{9862:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"search"},[t("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入教材名称"},model:{value:e.queryCondition.textbookName,callback:function(t){e.$set(e.queryCondition,"textbookName",t)},expression:"queryCondition.textbookName"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",plain:""},on:{click:function(t){return e.load(1)}}},[e._v("查询")]),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",plain:""},on:{click:e.reset}},[e._v("重置")])],1),t("div",{staticClass:"operation"},["ADMIN"===e.user.roleName?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",plain:""},on:{click:e.facultyAdd}},[e._v(" 新增学院 ")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"success",plain:""},on:{click:e.departmentAdd}},[e._v(" 新增部门 ")]):e._e()],1),t("div",{staticClass:"table"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-table",{attrs:{data:e.facultyLoadPage,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",idth:"45",align:"center"}}),t("el-table-column",{attrs:{prop:"facultyId",label:"序号","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{label:"图片",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[a.row.facultyBadge?t("el-image",{staticStyle:{width:"40px",height:"40px","border-radius":"50%"},attrs:{src:a.row.facultyBadge,"preview-src-list":[a.row.facultyBadge]}}):e._e()],1)]}}])}),t("el-table-column",{attrs:{prop:"facultyName",label:"学院名称","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{plain:"",type:"success",size:"mini"},on:{click:function(t){return e.queryDepartment(a.row)}}},[e._v("专业")]),"ADMIN"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.facultyEdit(a.row)}}},[e._v("编辑")]):e._e()]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.pageNum,"page-sizes":[1,10,20],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1),t("el-col",{attrs:{span:14}},[t("el-table",{attrs:{data:e.departmentLoadPage,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",idth:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"departmentName",label:"专业名称","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"departmentManagerName",label:"系主任","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{prop:"facultyName",label:"学院","show-overflow-tooltip":"",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return["ADMIN"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.departmentEdit(a.row)}}},[e._v("编辑")]):e._e(),"ADMIN"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"danger",size:"mini"},on:{click:function(t){return e.delDepartment(a.row.departmentId)}}},[e._v("删除")]):e._e(),"TEACHER"===e.user.roleName||"MANAGER"===e.user.roleName?t("el-button",{attrs:{plain:"",type:"success",size:"mini"},on:{click:function(t){return e.order(a.row)}}},[e._v("征订")]):e._e()]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.departmentPageNum,"page-sizes":[1,10,20],"page-size":e.departmentPageSize,layout:"total, prev, pager, next",total:e.departmentTotal},on:{"current-change":e.departmentCurrentChange}})],1)],1)],1)],1),t("el-dialog",{attrs:{title:"",name:"信息",visible:e.fromVisible1,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible1=t}}},[t("el-form",{ref:"facultyFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.facultyForm,rules:e.facultyRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"图片"}},[t("div",[t("el-upload",{attrs:{"list-type":"picture-card",action:e.$baseUrl+"/files/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[e.facultyForm.facultyBadge?t("img",{staticClass:"avatar",staticStyle:{width:"148px",height:"148px"},attrs:{src:e.facultyForm.facultyBadge}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)]),t("el-form-item",{attrs:{label:"学院名称",prop:"facultyName"}},[t("el-input",{attrs:{placeholder:"学院名称"},model:{value:e.facultyForm.facultyName,callback:function(t){e.$set(e.facultyForm,"facultyName",t)},expression:"facultyForm.facultyName"}})],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveFaculty}},[e._v("保 存")])],1)],1)],1),t("el-dialog",{attrs:{title:"",name:"信息",visible:e.fromVisible2,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible2=t}}},[t("el-form",{ref:"departmentFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.departmentForm,rules:e.departmentRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"部门名称",prop:"departmentName"}},[t("el-input",{attrs:{placeholder:"部门名称"},model:{value:e.departmentForm.departmentName,callback:function(t){e.$set(e.departmentForm,"departmentName",t)},expression:"departmentForm.departmentName"}})],1),t("el-form-item",{attrs:{label:"系主任",prop:"departmentManagerName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",placeholder:"请选择角色"},model:{value:e.departmentForm.departmentManagerName,callback:function(t){e.$set(e.departmentForm,"departmentManagerName",t)},expression:"departmentForm.departmentManagerName"}},e._l(e.userData,(function(e){return t("el-option",{key:e.userId,attrs:{label:e.realName,value:e.realName}})})),1)],1),t("el-form-item",{attrs:{label:"学院",prop:"facultyId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择学院"},model:{value:e.departmentForm.facultyId,callback:function(t){e.$set(e.departmentForm,"facultyId",t)},expression:"departmentForm.facultyId"}},e._l(e.facultyData,(function(e){return t("el-option",{key:e.facultyName,attrs:{label:e.facultyName,value:e.facultyId}})})),1)],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveDepartment}},[e._v("保 存")])],1)],1)],1),t("el-dialog",{attrs:{title:"征订单",name:"征订",visible:e.orderVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.orderVisible=t}}},[t("el-form",{ref:"orderFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.orderForm,rules:e.orderRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"书名",prop:"textbookName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",placeholder:"教材"},model:{value:e.orderForm.textbookName,callback:function(t){e.$set(e.orderForm,"textbookName",t)},expression:"orderForm.textbookName"}},e._l(e.textbookData,(function(e){return t("el-option",{key:e.textbookName,attrs:{label:e.textbookName,value:e.textbookName}})})),1)],1),t("el-form-item",{attrs:{label:"申请数量",prop:"applicationNumber"}},[t("el-input",{attrs:{placeholder:"申请数量"},model:{value:e.orderForm.applicationNumber,callback:function(t){e.$set(e.orderForm,"applicationNumber",t)},expression:"orderForm.applicationNumber"}})],1),t("el-form-item",{attrs:{label:"使用系别",prop:"departmentName"}},[t("el-input",{attrs:{placeholder:"使用系别"},model:{value:e.orderForm.departmentName,callback:function(t){e.$set(e.orderForm,"departmentName",t)},expression:"orderForm.departmentName"}})],1),t("el-form-item",{attrs:{label:"申请说明",prop:"applicationIllustration"}},[t("el-input",{attrs:{type:"textarea",row:2,placeholder:"申请说明"},model:{value:e.orderForm.applicationIllustration,callback:function(t){e.$set(e.orderForm,"applicationIllustration",t)},expression:"orderForm.applicationIllustration"}})],1),t("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveOrder}},[e._v("保 存")])],1)],1)],1)],1)},l=[],o=(a(4361),{name:"Department",data(){return{available:!1,facultyData:[],facultyLoadPage:[],departmentData:[],departmentLoadPage:[],textbookData:[],pageNum:1,pageSize:10,total:0,departmentPageNum:1,departmentPageSize:10,departmentTotal:0,facultyId:1,fromVisible1:!1,fromVisible2:!1,orderVisible:!1,facultyForm:{},departmentForm:{},facultyRules:{},departmentRules:{},user:JSON.parse(localStorage.getItem("xm-user")||"{}"),userData:[],queryCondition:{textbookName:null},orderForm:{},orderRules:{textbookName:[{required:!0,message:"请选择书名",trigger:"blur"}],applicationNumber:[{required:!0,message:"请输入数量",trigger:"blur"},{pattern:/^[1-9][0-9]*$/,message:"数量格式不对，请输入数字",trigger:"blur"}]}}},created(){this.loadFaculty(),this.loadFacultyPage(1),this.loadDepartment(),this.loadDepartmentPage(1),this.queryTeacher(),this.loadTextbook()},methods:{loadFaculty(){this.$request.get("/faculty/selectAll").then((e=>{"200"===e.code?this.facultyData=e.data:this.$message.error(e,msg)}))},loadDepartment(){this.$request.get("/department/selectAll").then((e=>{"200"===e.code?this.departmentData=e.data:this.$message.error(e,msg)}))},loadTextbook(){this.$request.get("/textbook/selectAll").then((e=>{"200"===e.code?(this.textbookData=e.data,this.textbookData=this.textbookData.filter((e=>"1"===e.orderStatus))):this.$message.error(e,msg)}))},loadFacultyPage(e){e&&(this.pageNum=e),this.$request.get("/faculty/selectPage",{params:{pageNum:this.pageNum,pageSize:this.pageSize}}).then((e=>{this.facultyLoadPage=e.data?.list,this.total=e.data?.total}))},loadDepartmentPage(e){e&&(this.departmentPageNum=e),this.$request.get("/department/selectPage",{params:{pageNum:this.departmentPageNum,pageSize:this.departmentPageSize,facultyId:this.facultyId}}).then((e=>{this.departmentLoadPage=e.data?.list,this.departmentTotal=e.data?.total}))},queryDepartment(e){this.facultyId=e.facultyId,this.loadDepartmentPage(1)},queryTeacher(){this.$request.get("/user/queryTeacher").then((e=>{"200"===e.code?this.userData=e.data:this.$message.error(e,msg)}))},facultyAdd(){this.facultyForm={},this.fromVisible1=!0},departmentAdd(){this.departmentForm={},this.fromVisible2=!0,this.queryTeacher()},order(e){this.orderForm={},this.orderVisible=!0,this.orderForm.departmentName=e.departmentName},saveOrder(){this.$refs["orderFormRef"].validate((e=>{e&&this.$request.post("/orderForm/addOrderForm",this.orderForm).then((e=>{"200"===e.code?(this.$message.success("征订成功"),this.orderVisible=!1):this.$message.error(e.msg)}))}))},facultyEdit(e){this.facultyForm=JSON.parse(JSON.stringify(e)),this.fromVisible1=!0},departmentEdit(e){this.departmentForm=JSON.parse(JSON.stringify(e)),this.fromVisible2=!0,this.queryTeacher()},saveFaculty(){this.$refs["facultyFormRef"].validate((e=>{e&&this.$request({url:this.facultyForm.facultyId?"/faculty/updateFaculty":"/faculty/addFaculty",method:this.facultyForm.facultyId?"PUT":"POST",data:this.facultyForm}).then((e=>{"200"===e.code?(this.$message.success("保存成功"),this.loadFacultyPage(1),this.fromVisible1=!1):this.$message.error(e.msg)}))}))},saveDepartment(){this.$refs["departmentFormRef"].validate((e=>{e&&this.$request({url:this.departmentForm.departmentId?"/department/updateDepartment":"/department/addDepartment",method:this.departmentForm.departmentId?"PUT":"POST",data:this.departmentForm}).then((e=>{"200"===e.code?(this.$message.success("保存成功"),this.loadDepartmentPage(1),this.fromVisible2=!1):this.$message.error(e.msg)}))}))},delDepartment(e){this.$confirm("您确定删除吗？","确认删除",{type:"warning"}).then((t=>{this.$request.delete("/department/deleteById/"+e).then((e=>{"200"===e.code?(this.$message.success("删除成功"),this.loadDepartmentPage(1)):this.$message.error(e.msg)}))})).catch((()=>{}))},handleSelectionChange(e){this.textbookIds=e.map((e=>e.textbookId))},delBatch(){this.textbookIds.length?this.$confirm("您确定批量删除这些数据吗？","确认删除",{type:"warning"}).then((e=>{this.$request.delete("/textbook/deleteBatch",{data:this.textbookIds}).then((e=>{"200"===e.code?(this.$message.success("删除成功"),this.load(1)):this.$message.error(e.msg)}))})).catch((()=>{})):this.$message.warning("请选择数据")},reset(){this.queryCondition.textbookName=null,this.load(1)},handleCurrentChange(e){this.loadFacultyPage(e)},departmentCurrentChange(e){this.loadDepartmentPage(e)},handleAvatarSuccess(e,t,a){this.facultyForm.facultyBadge=e.data}}}),s=o,i=a(3736),n=(0,i.Z)(s,r,l,!1,null,"15c6e2ea",null),m=n.exports}}]);
//# sourceMappingURL=813.6a083ba6.js.map